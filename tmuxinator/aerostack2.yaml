<%
# Input parameters
drone_namespace          = @settings["drone_namespace"]
platform                 = @settings["platform"]
config_folder            = @settings["config_folder"]
base_launch              = @settings["base_launch"] == "true"

# Available platforms
gazebo = "gz"
multirotor_simulator = "ms"
crazyflie = "cf"
%>

name: <%= drone_namespace %>
attach: false
root: ./
windows:
  # Platform
  - platform:
      layout: tiled
      panes: 
      # Platform Gazebo
      <%- if platform == gazebo %>
      <%- if base_launch %>
        - ros2 launch as2_gazebo_assets launch_simulation.py
          use_sim_time:=true
          simulation_config_file:=<%= config_folder %>/world.yaml
      <%- end %>
        - ros2 launch as2_platform_gazebo platform_gazebo_launch.py
            namespace:=<%= drone_namespace %>
            platform_config_file:=<%= config_folder %>/config_file.yaml
            simulation_config_file:=<%= config_folder %>/world.yaml
      <%- end %>
      # Platform Multirotor Simulator
      <%- if platform == multirotor_simulator %>
        - ros2 launch as2_platform_multirotor_simulator as2_platform_multirotor_simulator.launch.py
            namespace:=<%= drone_namespace %>
            config_file:=<%= config_folder %>/config_file.yaml
            world_config:=<%= config_folder %>/world.yaml
      <%- end %>
     # Platform Crazyflie
      <%- if platform == crazyflie %>
        <%- if base_launch %>
        - ros2 launch as2_platform_crazyflie crazyflie_swarm_launch.py
            swarm_config_file:=<%= config_folder %>/config_file.yaml
        <%- end %>
      <%- end %>

  # Basic Robotics Functions
  - basics_robotics_functions:
      layout:
      panes:
        # State Estimation
        - ros2 launch as2_state_estimator state_estimator_launch.py
            namespace:=<%= drone_namespace %>
            config_file:=<%= config_folder %>/config_file.yaml
        # Motion Controller
        - ros2 launch as2_motion_controller controller_launch.py
            namespace:=<%= drone_namespace %>
            config_file:=<%= config_folder %>/config_file.yaml
            plugin_name:=pid_speed_controller
            plugin_config_file:=<%= config_folder %>/pid_speed_controller.yaml

  # Behaviors
  - behaviors:
      layout:
      panes:
        # Motion Behaviors
        - ros2 launch as2_behaviors_motion motion_behaviors_launch.py
            namespace:=<%= drone_namespace %>
            config_file:=<%= config_folder %>/config_file.yaml
